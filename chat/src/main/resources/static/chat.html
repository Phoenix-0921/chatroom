<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" type="text/css"  href="style.css">
  <link rel="stylesheet" type="text/css"  href="muen.css">
  <!-- 引入axios套件，用來透過HTTP協定在網頁內呼叫後端的API -->
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <!-- 引入Vue.js -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <title>隨機聊天室</title>
</head>
<body>
    <input type="checkbox" id="active">
    <label for="active" class="menu-btn"><span></span></label>
    <label for="active" class="close"></label>
    <div class="wrapper">
    <ul>
  <li><a href="watching_movie.html">已看過清單</a></li>
  <li><a href="rating_movie.html">已評分過清單</a></li>
  <li><a href="#">尋找影片</a></li>
  <li><a href="moviedata.html">電影頁面</a></li>
  <li><a href="login.html">登入</a></li>
</ul>
</div>
<div class="menu">
  <a href="#" class="back"><i class="fa fa-angle-left"></i> <img src="https://i.imgur.com/G4EjwqQ.jpg" draggable="false"/></a>
  <div class="name">Random chat</div>
<div class="members"><b>You</div>
</div>
<ol class="chat">
<li class="other">
<div class="msg">
<div class="user">Marga<span class="range admin">Admin</span></div>
<p>Dude</p>
<p>Want to go dinner?</p>
<time>20:17</time>
</div>
</li>
<li class="self">
<div class="msg">
<p>Puff...</p>
<p>I'm still doing the Góngora comment...</p>
<p>Better other day</p>
<time>20:18</time>
</div>
</ol>
<div class="typezone">
<form><textarea type="text" placeholder="Say something"></textarea><input type="submit" class="send" value=""/></form>
</div>
</body>
<script lang="javascript">

	const {createApp} = Vue
	//建立vue物件
	createApp({
	   data() {
		 // 這裡出現的變數才可以在網頁內使用
		 return {
		   showWarning: false, // 開關警告訊息用
		   username:'', //存放使用者帳號
		   password:'', //存放使用者密碼
		 }
	   },
	   
	   //新增watch方法
	   watch: {
		   // 監看username變數
		   username(newVal,oldVal){
			   //當帳號名稱已不再有特殊字元時，停止顯示警告訊息
			   
			   var pattern = new RegExp("[`~!@#$^&*()=|{}':;',\\[\\].<>《》/?~！@#￥……&*（）——|{}【】‘；：”“'。，、？]");
			   if(!pattern.test(newVal))
				  this.showWarning = false;
		   }
	   },

	   //vue 的方法放這裡
	   methods: {
		   
		   
		   
		   //檢查帳號有沒有包含不允許的字元
		   checkAccount(){
			   console.log('checkAccount');
		   /*if(this.username.includes('\'')==true)
				this.showWarning = true;*/

		   // 如果帳號名稱出現特殊字元，顯示警告訊息
		    
		    var pattern = new RegExp("[`~!@#$^&*()=|{}':;',\\[\\].<>《》\\/?~！@#￥……&*（）——|{}【】‘；：”“'。，、？]");
			if (pattern.test(this.username)) {
    		this.showWarning = true;
			} else {
			  //取代 document.getElementById
			  //送出表單
			  //this.$refs.form.submit();

			  //打API
			  axios.get("/login?username=" + this.username + "&password=" + this.password)
			  .then((response) => {
			   //get完成後收到的資料在這裡處理
			   console.log(response);

			   if(response.data.code == 0) //登入成功
				  location.href = '/card.html';
			   else //登入失敗
				  location.href = "loginResult.html?message=" +response.data.message;
			  })
			  .catch( (error) => {
			   console.log(error);
			  });
		   }
		 }  
	   }
   }).mount('#app');




</script>
</html>